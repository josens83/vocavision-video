name: Render Video/Image

on:
  workflow_dispatch:
    inputs:
      composition:
        description: '렌더링할 컴포지션 ID'
        required: true
        default: 'WordShort'
        type: choice
        options:
          # 영상
          - CompanyIntro-KR
          - CompanyIntro-EN
          - WordShort
          - WordShort-set-001
          - WordShort-set-002
          - WordShort-set-003
          - WordShort-set-004
          - WordShort-set-005
          - WordShort-set-006
          - WordShort-set-007
          - WordShort-set-008
          - WordShort-set-009
          - WordShort-set-010
          - WordShort-set-011
          # 인스타 카드 (이미지)
          - InstaCard-set004-cover
          - InstaCard-tampering
          - InstaCard-tempering
          - InstaCard-tapering
          - InstaCard-set005-cover
          - InstaCard-hallucination
          - InstaCard-agent
          - InstaCard-prompt
          - InstaCard-set006-cover
          - InstaCard-lunar
          - InstaCard-ritual
          - InstaCard-prosperity
          - InstaCard-set007-cover
          - InstaCard-trajectory
          - InstaCard-autonomous
          - InstaCard-redundancy
          - InstaCard-set008-cover
          - InstaCard-resolution
          - InstaCard-reunion
          - InstaCard-gratitude
          - InstaCard-CTA
          - InstaCard-set009-cover
          - InstaCard-apathy
          - InstaCard-ambivalent
          - InstaCard-ardent
          - InstaCard-set010-cover
          - InstaCard-empathy
          - InstaCard-animosity
          - InstaCard-amiable
          - InstaCard-set011-cover
          - InstaCard-allure
          - InstaCard-captivate
          - InstaCard-cherish
          - WordShort-set-012
          - InstaCard-set012-cover
          - InstaCard-clandestine
          - InstaCard-persecute
          - InstaCard-commemorate
          - WordShort-set-013
          - InstaCard-set013-cover
          - InstaCard-scrutinize
          - InstaCard-contemplate
          - InstaCard-discern
          - WordShort-set-014
          - InstaCard-set014-cover
          - InstaCard-aspire
          - InstaCard-relentless
          - InstaCard-persevere
          - WordShort-set-015
          - InstaCard-set015-cover
          - InstaCard-adversity
          - InstaCard-resilience
          - InstaCard-triumph
          - WordShort-set-016
          - InstaCard-set016-cover
          - InstaCard-procrastinate
          - InstaCard-diligent
          - InstaCard-tenacious
          - WordShort-set-017
          - InstaCard-set017-cover
          - InstaCard-serenity
          - InstaCard-loyalty
          - InstaCard-bond
          - WordShort-set-018
          - InstaCard-set018-cover
          - InstaCard-introvert
          - InstaCard-extrovert
          - InstaCard-intuition
          - WordShort-set-019
          - InstaCard-set019-cover
          - InstaCard-underdog
          - InstaCard-breakthrough
          - InstaCard-legacy
          - WordShort-set-020
          - InstaCard-set020-cover
          - InstaCard-perceive
          - InstaCard-judgment
          - InstaCard-sensation
          - WordShort-set-021
          - InstaCard-set021-cover
          - InstaCard-viral
          - InstaCard-algorithm
          - InstaCard-influence
          - WordShort-set-022
          - InstaCard-set022-cover
          - InstaCard-respawn
          - InstaCard-nerf
          - InstaCard-grind
          - WordShort-set-023
          - InstaCard-set023-cover
          - InstaCard-bias
          - InstaCard-alignment
          - InstaCard-ethical
          - WordShort-set-024
          - InstaCard-set024-cover
          - InstaCard-binge
          - InstaCard-spoiler
          - InstaCard-cliffhanger
          - WordShort-set-025
          - InstaCard-set025-cover
          - InstaCard-lag
          - InstaCard-buff
          - InstaCard-meta
          - WordShort-set-026
          - InstaCard-set026-cover
          - InstaCard-semester
          - InstaCard-curriculum
          - InstaCard-scholarship
          - WordShort-set-027
          - InstaCard-set027-cover
          - InstaCard-engagement
          - InstaCard-trending
          - InstaCard-follower
          - WordShort-set-028
          - InstaCard-set028-cover
          - InstaCard-recipe
          - InstaCard-ingredient
          - InstaCard-flavor
          - WordShort-set-029
          - InstaCard-set029-cover
          - InstaCard-bullish
          - InstaCard-bearish
          - InstaCard-portfolio

jobs:
  render:
    name: Render
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Install Chrome dependencies
        run: npx remotion browser ensure

      - name: Generate TTS audio
        if: startsWith(github.event.inputs.composition, 'CompanyIntro-')
        run: |
          pip install edge-tts
          mkdir -p public/audio

          # 한국어
          edge-tts --voice "ko-KR-SunHiNeural" --text "영단어, 외워도 외워도 까먹으시죠?" --write-media public/audio/kr-scene1.mp3
          edge-tts --voice "ko-KR-SunHiNeural" --text "VocaVision AI는 AI 이미지와 재미있는 라임으로 영단어를 머릿속에 그려넣는 학습법입니다." --write-media public/audio/kr-scene2.mp3
          edge-tts --voice "ko-KR-SunHiNeural" --text "AI 이미지로 시각적으로 기억하고, 어원 분석으로 뿌리부터 이해하고, 재미있는 라임으로 한번 들으면 잊을 수 없습니다." --write-media public/audio/kr-scene3.mp3
          edge-tts --voice "ko-KR-SunHiNeural" --text "수능, 텝스, 토플까지 7,600개 이상의 단어를 커버합니다." --write-media public/audio/kr-scene4.mp3
          edge-tts --voice "ko-KR-SunHiNeural" --text "일반 단어장은 뜻만 나열합니다. VocaVision은 여러분의 뇌가 기억하기 쉬운 방식으로 설계되었습니다." --write-media public/audio/kr-scene5.mp3
          edge-tts --voice "ko-KR-SunHiNeural" --text "지금 무료로 시작하세요. VocaVision AI, 이미지로 기억하는 영단어." --write-media public/audio/kr-scene6.mp3

          # 영어
          edge-tts --voice "en-US-JennyNeural" --text "You study English vocabulary, but keep forgetting, right?" --write-media public/audio/en-scene1.mp3
          edge-tts --voice "en-US-JennyNeural" --text "VocaVision AI uses AI-generated images and fun rhymes to paint words in your mind." --write-media public/audio/en-scene2.mp3
          edge-tts --voice "en-US-JennyNeural" --text "Visually remember with AI images, understand roots through etymology, and never forget with catchy rhymes." --write-media public/audio/en-scene3.mp3
          edge-tts --voice "en-US-JennyNeural" --text "Covering over seven thousand six hundred words across CSAT, TEPS, and TOEFL." --write-media public/audio/en-scene4.mp3
          edge-tts --voice "en-US-JennyNeural" --text "Regular flashcards just list definitions. VocaVision is designed for how your brain actually remembers." --write-media public/audio/en-scene5.mp3
          edge-tts --voice "en-US-JennyNeural" --text "Start for free today. VocaVision AI, vocabulary you can see." --write-media public/audio/en-scene6.mp3

      - name: Render
        run: |
          COMP="${{ github.event.inputs.composition }}"

          # InstaCard로 시작하면 이미지 렌더링
          if [[ "$COMP" == InstaCard-* ]]; then
            npx remotion still "$COMP" "out/$COMP.png"
          else
            npx remotion render "$COMP" "out/$COMP.mp4"
          fi

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: ${{ github.event.inputs.composition }}
          path: out/
          retention-days: 7

